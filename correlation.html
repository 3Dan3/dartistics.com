<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Correlation</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">R Masterclass</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="intros.html">Introductions</a>
    </li>
    <li>
      <a href="whatisr.html">What Is R?</a>
    </li>
    <li>
      <a href="example1.html">Example: Trending</a>
    </li>
    <li>
      <a href="example2.html">Example: Data Explorer</a>
    </li>
    <li>
      <a href="example3.html">Example: Venn Diagram</a>
    </li>
    <li>
      <a href="example4.html">Example: GA Effect</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exercise1-thebasics.html">1. The Basic Basics</a>
    </li>
    <li>
      <a href="exercise2-io.html">2. I/O</a>
    </li>
    <li>
      <a href="exercise3-accessing-data.html">3. Accessing Data</a>
    </li>
    <li>
      <a href="exercise4-tidy-dplyr.html">4. Tidy Data / dplyr()</a>
    </li>
    <li>
      <a href="exercise5-correlation.html">5. Correlation</a>
    </li>
    <li>
      <a href="exercise6-regression.html">6. Regression</a>
    </li>
    <li>
      <a href="exercise7-visualisation.html">7. Visualisation</a>
    </li>
    <li>
      <a href="exercise8-rmarkdown.html">8. RMarkdown</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="rstudio.html">RStudio</a>
    </li>
    <li>
      <a href="packages.html">Packages</a>
    </li>
    <li>
      <a href="import-csv-excel.html">CSV import</a>
    </li>
    <li>
      <a href="basics-base_r.html">Basics of Base R</a>
    </li>
    <li>
      <a href="classes.html">R Classes</a>
    </li>
    <li>
      <a href="accessing.html">Accessing elements</a>
    </li>
    <li>
      <a href="tidyverse.html">Tidy data / Tidyverse</a>
    </li>
    <li>
      <a href="dplyr.html">dplyr()</a>
    </li>
    <li>
      <a href="habits.html">Good habits</a>
    </li>
    <li>
      <a href="analytics-apis.html">Analytics APIs</a>
    </li>
    <li class="dropdown-header">Microsoft Excel(!)</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="modelling-intro.html">Introduction</a>
    </li>
    <li>
      <a href="correlation.html">Correlation</a>
    </li>
    <li class="dropdown-header">Regression</li>
    <li class="dropdown-header">Time-series</li>
    <li class="dropdown-header">Categorisation</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Visualisation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Options</li>
    <li class="dropdown-header">Base Plots</li>
    <li class="dropdown-header">ggplot2()</li>
    <li class="dropdown-header">htmlwidgets()</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Presentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">RMarkdown</li>
    <li class="dropdown-header">Shiny</li>
    <li class="dropdown-header">RMarkdown + Shiny</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Wrap-Up
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Key topics</li>
    <li class="dropdown-header">GitHub</li>
    <li class="dropdown-header">Best practices</li>
    <li>
      <a href="resources.html">Additional Resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Correlation</h1>

</div>


<p>Correlation is a number that describes how much relationship is between two variables.</p>
<p>In digital analytis terms, you can use it to explore relationships between web metrics to see if an influence can be inferred, but beware the 101 stat advice of not accounting for other factors. This is fairly rampant in the SEO industry. For instance, a high correlation between social shares and SEO position could mean:</p>
<ul>
<li>Social shares influence SEO position</li>
<li>SEO position influences social shares</li>
<li>Social shares and SEO position are influenced by a third factor (such as Brand strength)</li>
<li>The relationship was a chance error</li>
</ul>
<p>It is rare to see the last three possibilties considered.</p>
<div id="performing-correlation-analysis-in-r" class="section level2">
<h2>Performing correlation analysis in R</h2>
<p>That said, correlations can really help get an understanding of your data and hint at relationships.</p>
<p>The base function <code>cor()</code> will perform correlations on a <code>data.frame</code>.</p>
<p>The below example uses the dataset used previously:</p>
<pre class="r"><code>web_data &lt;- read.csv(&quot;./data/gadata_example_2.csv&quot;, stringsAsFactors = FALSE)
head(web_data)</code></pre>
<pre><code>##   X       date channelGrouping deviceCategory sessions pageviews entrances
## 1 1 2016-01-01         (Other)        desktop       19        23        19
## 2 2 2016-01-01         (Other)         mobile      112       162       112
## 3 3 2016-01-01         (Other)         tablet       24        41        24
## 4 4 2016-01-01          Direct        desktop      133       423       133
## 5 5 2016-01-01          Direct         mobile      345       878       344
## 6 6 2016-01-01          Direct         tablet      126       237       126
##   bounces
## 1      15
## 2      82
## 3      19
## 4      61
## 5     172
## 6      77</code></pre>
<pre class="r"><code>web_data_metrics &lt;- web_data[c(&quot;sessions&quot;,&quot;pageviews&quot;,&quot;entrances&quot;,&quot;bounces&quot;)]
## see correlation between sessions an pageviews
cor(web_data_metrics)</code></pre>
<pre><code>##            sessions pageviews entrances   bounces
## sessions  1.0000000 0.8384321 0.9999923 0.9411201
## pageviews 0.8384321 1.0000000 0.8377078 0.6364753
## entrances 0.9999923 0.8377078 1.0000000 0.9416535
## bounces   0.9411201 0.6364753 0.9416535 1.0000000</code></pre>
<p>When working with correlations, its always a good idea to view an exploratory plot to see if any outliers are effecting your metrics:</p>
<pre class="r"><code>pairs(web_data_metrics)</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="how-do-web-channels-correlate" class="section level2">
<h2>How do web channels correlate?</h2>
<p>One useful piece of analysis is seeing how web channels possibly interact.</p>
<p>To get the data in the right format, the below code pivots via the <code>reshape2</code> package:</p>
<pre class="r"><code>## get only desktop rows, and the date, channelGrouping and sessions columns
per_channel &lt;- web_data[web_data$deviceCategory == &quot;desktop&quot;, c(&quot;date&quot;,&quot;channelGrouping&quot;,&quot;sessions&quot;)] 

## use reshape2&#39;s dcast to pivot the data
library(reshape2)
pivoted &lt;- dcast(per_channel, date ~ channelGrouping, fun.aggregate = sum, value.var = &quot;sessions&quot;)
head(pivoted)</code></pre>
<pre><code>##         date (Other) Direct Display Email Organic Search Paid Search
## 1 2016-01-01      19    133     307    17            431         555
## 2 2016-01-02     156   1003     196    43           1077        1060
## 3 2016-01-03      35   1470     235    29            696         489
## 4 2016-01-04      31   1794     321    70           1075         558
## 5 2016-01-05      27   1899     309    74           1004         478
## 6 2016-01-06      21   1972     204   299            974         494
##   Referral Social Video
## 1      131     68     0
## 2      226    158     3
## 3      179     66    90
## 4      235     46   898
## 5      218     47   461
## 6      246     47   418</code></pre>
<p>Lets now see if Display and Paid correlate:</p>
<pre class="r"><code>cor(pivoted$Display, pivoted$`Paid Search`)</code></pre>
<pre><code>## [1] 0.05289315</code></pre>
<p>Not at all! See the plot:</p>
<pre class="r"><code>plot(as.Date(pivoted$date), pivoted$Display, type = &quot;l&quot;)
lines(as.Date(pivoted$date), pivoted$`Paid Search`)</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The two differing spikes hint at why the correlation failed.</p>
<pre class="r"><code>plot(as.Date(pivoted$date), pivoted$Display, type = &quot;l&quot;)
lines(as.Date(pivoted$date), pivoted$`Paid Search`)</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>cor(pivoted[-1])</code></pre>
<pre><code>##                    (Other)      Direct     Display      Email
## (Other)         1.00000000  0.12743479  0.11976504 0.09419624
## Direct          0.12743479  1.00000000  0.04036891 0.07208526
## Display         0.11976504  0.04036891  1.00000000 0.01001570
## Email           0.09419624  0.07208526  0.01001570 1.00000000
## Organic Search  0.16660245  0.21963582 -0.04628897 0.26241579
## Paid Search     0.03461935 -0.02233086  0.05289315 0.03498069
## Referral       -0.04104845  0.09400806 -0.10116768 0.13186681
## Social          0.46029627 -0.04864601  0.19312976 0.03326082
## Video           0.37183368  0.01428600  0.27306324 0.13428036
##                Organic Search Paid Search    Referral      Social
## (Other)            0.16660245  0.03461935 -0.04104845  0.46029627
## Direct             0.21963582 -0.02233086  0.09400806 -0.04864601
## Display           -0.04628897  0.05289315 -0.10116768  0.19312976
## Email              0.26241579  0.03498069  0.13186681  0.03326082
## Organic Search     1.00000000  0.50911991  0.19389553 -0.04091869
## Paid Search        0.50911991  1.00000000  0.07755885 -0.01073152
## Referral           0.19389553  0.07755885  1.00000000 -0.10516192
## Social            -0.04091869 -0.01073152 -0.10516192  1.00000000
## Video              0.08146977  0.22177828 -0.25423741  0.49831671
##                      Video
## (Other)         0.37183368
## Direct          0.01428600
## Display         0.27306324
## Email           0.13428036
## Organic Search  0.08146977
## Paid Search     0.22177828
## Referral       -0.25423741
## Social          0.49831671
## Video           1.00000000</code></pre>
<pre class="r"><code>pairs(pivoted[-1])</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="auto-and-cross-correlation" class="section level2">
<h2>Auto and cross correlation</h2>
<p>The correlations above all compare the same date point, but what if you expect a lagged effect?</p>
<p>Auto and cross correlations are useful when dealing with time-series data, and can examine if a metric has an influence on itself or another after some time has passed.</p>
<p>This can be a powerful way to find if say a TV or Display campaign increased SEO traffic the next few weeks afterwards.</p>
<p>The below compares paid search on SEO - the correlation for different lags of days is the result - we can see a correlation at 0 lag at around 0.5, but the correlation increases if you compare the SEO peaks to the paid peaks</p>
<pre class="r"><code>ccf(pivoted$`Paid Search`, pivoted$`Organic Search`)</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Looking at the data plots you can see a peak that most likely created this correlation peak in the data, with the red (Paid) peak precedding the Organic.</p>
<pre class="r"><code>## zoom in to the peak, and scale the metrics so they have same size peaks to illustrate
plot(as.Date(pivoted$date)[31:90], scale(pivoted$`Paid Search`[31:90]), type = &quot;l&quot;, col = &quot;red&quot;)
lines(as.Date(pivoted$date)[31:90], scale(pivoted$`Organic Search`[31:90]), col = &quot;blue&quot;)</code></pre>
<p><img src="correlation_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
